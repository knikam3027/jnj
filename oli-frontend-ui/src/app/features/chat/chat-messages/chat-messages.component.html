<div class="flex-1 overflow-y-auto px-3 md:px-6 py-4 pb-24">
  @if (messages.length === 0 && !isLoading) {
    <!-- Welcome Message -->
    <div class="flex flex-col items-center justify-center h-full">
      <div class="w-24 h-24 md:w-32 md:h-32 rounded-full mb-4 overflow-hidden">
        <img src="assets/images/chatbot.png" alt="OLI Assistant" class="w-full h-full object-cover">
      </div>
      <h2 class="text-2xl font-bold mb-2" style="color: #5D1E1B;">Hello, John I'm OLI</h2>
      <p class="text-gray-600">J&J Chat Assistant. How can I help you?</p>
    </div>
  }

  <!-- Messages -->
  @for (message of messages; track message.id) {
    <div class="mb-6">
      @if (message.sender === 'user') {
        <!-- User Message -->
        <div class="flex justify-end">
          <div class="max-w-full md:max-w-3xl w-full md:w-auto">
            <div class="flex items-start gap-2 mb-1">
              <span class="text-sm font-semibold text-gray-700">You</span>
            </div>
            @if (editingMessageId === message.id) {
              <!-- Edit Mode -->
              <div class="rounded-lg px-4 py-3" style="background-color: #D9D9D9;">
                <textarea 
                  [(ngModel)]="editedContent"
                  class="w-full bg-white rounded border border-gray-300 px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="3"></textarea>
                <div class="flex gap-2 mt-2">
                  <button 
                    (click)="saveEdit(message.id)"
                    class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                    Send
                  </button>
                  <button 
                    (click)="cancelEdit()"
                    class="px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400">
                    Cancel
                  </button>
                </div>
              </div>
            } @else {
              <!-- View Mode -->
              <div class="rounded-lg px-4 py-3" style="background-color: #D9D9D9;">
                <p class="text-gray-800">{{ message.content }}</p>
              </div>
            }
            <div class="flex items-center gap-2 mt-1 justify-end">
              <span class="text-xs text-gray-500">
                {{ message.timestamp | date:'short' }}
              </span>
              @if (message.isEditable && editingMessageId !== message.id) {
                <button (click)="startEdit(message)" class="text-xs text-gray-500 hover:text-gray-700" title="Edit">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                  </svg>
                </button>
                <button (click)="copyToClipboard(message.content)" class="text-xs text-gray-500 hover:text-gray-700" title="Copy">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                  </svg>
                </button>
              }
            </div>
          </div>
        </div>
      } @else {
        <!-- Bot Message -->
        <div class="flex justify-start">
          <div class="max-w-full md:max-w-3xl w-full md:w-auto">
            <div class="flex items-start gap-2 mb-2">
              <div class="w-12 h-12 md:w-16 md:h-16 rounded-full overflow-hidden flex-shrink-0">
                <img src="assets/images/chatbot.png" alt="OLI" class="w-full h-full object-cover">
              </div>
            </div>
            <div class="bg-white border border-gray-200 rounded-lg px-4 py-3">
              <p class="text-gray-800 whitespace-pre-wrap">{{ message.content }}</p>
            </div>
            <div class="flex items-center gap-2 mt-2">
              <button (click)="copyToClipboard(message.content)" class="p-1 hover:bg-gray-100 rounded" title="Copy">
                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
              </button>
              <button (click)="downloadMessage(message.content)" class="p-1 hover:bg-gray-100 rounded" title="Download">
                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
              </button>
              <span class="text-xs text-gray-500 ml-auto">
                {{ message.timestamp | date:'short' }}
              </span>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Loading Indicator -->
  @if (isLoading) {
    <div class="flex items-start gap-2">
      <div class="w-16 h-16 rounded-full overflow-hidden">
        <img src="assets/images/chatbot.png" alt="OLI" class="w-full h-full object-cover animate-pulse">
      </div>
      <div class="bg-white border border-gray-200 rounded-lg px-4 py-3">
        <p class="text-gray-500">Thinking...</p>
      </div>
    </div>
  }
</div>
